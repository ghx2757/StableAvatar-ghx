
单卡推理-lora
bash inference.sh
--lora_path="${checkpoint_path_prefix}/checkpoint-${train_steps}/lora-checkpoint-${train_steps}.pt" \

# 多卡推理
bash multiple_gpu_inference.sh
# 合并音视频
ffmpeg -i TestData/output/lmy-white-8000-2/video_without_audio.mp4 -i TestData/audio/lmy_60s_16k.wav -c:v copy -c:a aac -shortest TestData/output/lmy-white-8000-2/video.mp4


## training
#1. 切片视频用的hallo3中的

#2. 提取图片，并组织文件夹结构
python tools/data_process.py \
    --input_videos /root/gaohaixiang/code/StableAvatar-ghx/TestData/src_video/20241208-201508-crop-clip \
    --output_path /root/gaohaixiang/code/StableAvatar-ghx/lmy_white_72mins \
    --max_workers 16

#3. 提取音频
sh extract_audio.sh

#4. 提取嘴唇mask(断了再续)
python tools/lip_mask_extractor.py --folder_root="lmy_white_72mins/square/speech" --start=474 --end=474 --max_workers=4

#5. 提取脸部mask
conda activate stb-ani
python tools/face_mask_seperator.py --image_folder /root/gaohaixiang/code/StableAvatar-ghx/lmy_white_72mins/square/speech

#6. 生成数据路径统计文件
bash tools/generate_paths.sh

# 全参微调
bash train_1B_square.sh

# lora微调
bash train_1B_square_lora.sh
